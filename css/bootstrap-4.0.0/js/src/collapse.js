import $ from"jquery";import Util from"./util";const Collapse=(t=>{const e="collapse",s="bs.collapse",i=t.fn[e],n={toggle:!0,parent:""},l={toggle:"boolean",parent:"(string|element)"},r="show.bs.collapse",a="shown.bs.collapse",o="hide.bs.collapse",g="hidden.bs.collapse",h="click.bs.collapse.data-api",c="show",_="collapse",d="collapsing",m="collapsed",p="width",f='[data-toggle="collapse"]';class u{constructor(e,s){this._isTransitioning=!1,this._element=e,this._config=this._getConfig(s),this._triggerArray=t.makeArray(t(`[data-toggle="collapse"][href="#${e.id}"],[data-toggle="collapse"][data-target="#${e.id}"]`));const i=t(f);for(let s=0;s<i.length;s++){const n=i[s],l=Util.getSelectorFromElement(n);null!==l&&t(l).filter(e).length>0&&(this._selector=l,this._triggerArray.push(n))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}static get VERSION(){return"4.0.0"}static get Default(){return n}toggle(){t(this._element).hasClass(c)?this.hide():this.show()}show(){if(this._isTransitioning||t(this._element).hasClass(c))return;let e,i;if(this._parent&&(e=t.makeArray(t(this._parent).find(".show, .collapsing").filter(`[data-parent="${this._config.parent}"]`)),0===e.length&&(e=null)),e&&(i=t(e).not(this._selector).data(s),i&&i._isTransitioning))return;const n=t.Event(r);if(t(this._element).trigger(n),n.isDefaultPrevented())return;e&&(u._jQueryInterface.call(t(e).not(this._selector),"hide"),i||t(e).data(s,null));const l=this._getDimension();t(this._element).removeClass(_).addClass(d),this._element.style[l]=0,this._triggerArray.length>0&&t(this._triggerArray).removeClass(m).attr("aria-expanded",!0),this.setTransitioning(!0);const o=()=>{t(this._element).removeClass(d).addClass(_).addClass(c),this._element.style[l]="",this.setTransitioning(!1),t(this._element).trigger(a)};if(!Util.supportsTransitionEnd())return void o();const g="scroll"+(l[0].toUpperCase()+l.slice(1));t(this._element).one(Util.TRANSITION_END,o).emulateTransitionEnd(600),this._element.style[l]=this._element[g]+"px"}hide(){if(this._isTransitioning||!t(this._element).hasClass(c))return;const e=t.Event(o);if(t(this._element).trigger(e),e.isDefaultPrevented())return;const s=this._getDimension();if(this._element.style[s]=this._element.getBoundingClientRect()[s]+"px",Util.reflow(this._element),t(this._element).addClass(d).removeClass(_).removeClass(c),this._triggerArray.length>0)for(let e=0;e<this._triggerArray.length;e++){const s=this._triggerArray[e],i=Util.getSelectorFromElement(s);null!==i&&(t(i).hasClass(c)||t(s).addClass(m).attr("aria-expanded",!1))}this.setTransitioning(!0);const i=()=>{this.setTransitioning(!1),t(this._element).removeClass(d).addClass(_).trigger(g)};this._element.style[s]="",Util.supportsTransitionEnd()?t(this._element).one(Util.TRANSITION_END,i).emulateTransitionEnd(600):i()}setTransitioning(t){this._isTransitioning=t}dispose(){t.removeData(this._element,s),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null}_getConfig(t){return(t={...n,...t}).toggle=Boolean(t.toggle),Util.typeCheckConfig(e,t,l),t}_getDimension(){return t(this._element).hasClass(p)?p:"height"}_getParent(){let e=null;Util.isElement(this._config.parent)?(e=this._config.parent,void 0!==this._config.parent.jquery&&(e=this._config.parent[0])):e=t(this._config.parent)[0];const s=`[data-toggle="collapse"][data-parent="${this._config.parent}"]`;return t(e).find(s).each(((t,e)=>{this._addAriaAndCollapsedClass(u._getTargetFromElement(e),[e])})),e}_addAriaAndCollapsedClass(e,s){if(e){const i=t(e).hasClass(c);s.length>0&&t(s).toggleClass(m,!i).attr("aria-expanded",i)}}static _getTargetFromElement(e){const s=Util.getSelectorFromElement(e);return s?t(s)[0]:null}static _jQueryInterface(e){return this.each((function(){const i=t(this);let l=i.data(s);const r={...n,...i.data(),..."object"==typeof e&&e};if(!l&&r.toggle&&/show|hide/.test(e)&&(r.toggle=!1),l||(l=new u(this,r),i.data(s,l)),"string"==typeof e){if(void 0===l[e])throw new TypeError(`No method named "${e}"`);l[e]()}}))}}return t(document).on(h,f,(function(e){"A"===e.currentTarget.tagName&&e.preventDefault();const i=t(this),n=Util.getSelectorFromElement(this);t(n).each((function(){const e=t(this),n=e.data(s)?"toggle":i.data();u._jQueryInterface.call(e,n)}))})),t.fn[e]=u._jQueryInterface,t.fn[e].Constructor=u,t.fn[e].noConflict=function(){return t.fn[e]=i,u._jQueryInterface},u})($);export default Collapse;
