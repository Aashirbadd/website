import $ from"jquery";import Popper from"popper.js";import Util from"./util";const Dropdown=(t=>{const e="dropdown",n="bs.dropdown",o=t.fn[e],s=new RegExp("38|40|27"),r="hide.bs.dropdown",i="hidden.bs.dropdown",a="show.bs.dropdown",l="shown.bs.dropdown",h="click.bs.dropdown",d="click.bs.dropdown.data-api",p="keydown.bs.dropdown.data-api",c="keyup.bs.dropdown.data-api",u="disabled",f="show",g="dropup",m="dropdown-menu-right",_='[data-toggle="dropdown"]',w=".dropdown-menu",b={offset:0,flip:!0,boundary:"scrollParent"},y={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)"};class v{constructor(t,e){this._element=t,this._popper=null,this._config=this._getConfig(e),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}static get VERSION(){return"4.0.0"}static get Default(){return b}static get DefaultType(){return y}toggle(){if(this._element.disabled||t(this._element).hasClass(u))return;const e=v._getParentFromElement(this._element),n=t(this._menu).hasClass(f);if(v._clearMenus(),n)return;const o={relatedTarget:this._element},s=t.Event(a,o);if(t(e).trigger(s),!s.isDefaultPrevented()){if(!this._inNavbar){if(void 0===Popper)throw new TypeError("Bootstrap dropdown require Popper.js (https://popper.js.org)");let n=this._element;t(e).hasClass(g)&&(t(this._menu).hasClass("dropdown-menu-left")||t(this._menu).hasClass(m))&&(n=e),"scrollParent"!==this._config.boundary&&t(e).addClass("position-static"),this._popper=new Popper(n,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===t(e).closest(".navbar-nav").length&&t("body").children().on("mouseover",null,t.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),t(this._menu).toggleClass(f),t(e).toggleClass(f).trigger(t.Event(l,o))}}dispose(){t.removeData(this._element,n),t(this._element).off(".bs.dropdown"),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}update(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}_addEventListeners(){t(this._element).on(h,(t=>{t.preventDefault(),t.stopPropagation(),this.toggle()}))}_getConfig(n){return n={...this.constructor.Default,...t(this._element).data(),...n},Util.typeCheckConfig(e,n,this.constructor.DefaultType),n}_getMenuElement(){if(!this._menu){const e=v._getParentFromElement(this._element);this._menu=t(e).find(w)[0]}return this._menu}_getPlacement(){const e=t(this._element).parent();let n="bottom-start";return e.hasClass(g)?(n="top-start",t(this._menu).hasClass(m)&&(n="top-end")):e.hasClass("dropright")?n="right-start":e.hasClass("dropleft")?n="left-start":t(this._menu).hasClass(m)&&(n="bottom-end"),n}_detectNavbar(){return t(this._element).closest(".navbar").length>0}_getPopperConfig(){const t={};return"function"==typeof this._config.offset?t.fn=t=>(t.offsets={...t.offsets,...this._config.offset(t.offsets)||{}},t):t.offset=this._config.offset,{placement:this._getPlacement(),modifiers:{offset:t,flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}}}static _jQueryInterface(e){return this.each((function(){let o=t(this).data(n);if(o||(o=new v(this,"object"==typeof e?e:null),t(this).data(n,o)),"string"==typeof e){if(void 0===o[e])throw new TypeError(`No method named "${e}"`);o[e]()}}))}static _clearMenus(e){if(e&&(3===e.which||"keyup"===e.type&&9!==e.which))return;const o=t.makeArray(t(_));for(let s=0;s<o.length;s++){const a=v._getParentFromElement(o[s]),l=t(o[s]).data(n),h={relatedTarget:o[s]};if(!l)continue;const d=l._menu;if(!t(a).hasClass(f))continue;if(e&&("click"===e.type&&/input|textarea/i.test(e.target.tagName)||"keyup"===e.type&&9===e.which)&&t.contains(a,e.target))continue;const p=t.Event(r,h);t(a).trigger(p),p.isDefaultPrevented()||("ontouchstart"in document.documentElement&&t("body").children().off("mouseover",null,t.noop),o[s].setAttribute("aria-expanded","false"),t(d).removeClass(f),t(a).removeClass(f).trigger(t.Event(i,h)))}}static _getParentFromElement(e){let n;const o=Util.getSelectorFromElement(e);return o&&(n=t(o)[0]),n||e.parentNode}static _dataApiKeydownHandler(e){if(/input|textarea/i.test(e.target.tagName)?32===e.which||27!==e.which&&(40!==e.which&&38!==e.which||t(e.target).closest(w).length):!s.test(e.which))return;if(e.preventDefault(),e.stopPropagation(),this.disabled||t(this).hasClass(u))return;const n=v._getParentFromElement(this),o=t(n).hasClass(f);if(!o&&(27!==e.which||32!==e.which)||o&&(27===e.which||32===e.which)){if(27===e.which){const e=t(n).find(_)[0];t(e).trigger("focus")}return void t(this).trigger("click")}const r=t(n).find(".dropdown-menu .dropdown-item:not(.disabled)").get();if(0===r.length)return;let i=r.indexOf(e.target);38===e.which&&i>0&&i--,40===e.which&&i<r.length-1&&i++,i<0&&(i=0),r[i].focus()}}return t(document).on(p,_,v._dataApiKeydownHandler).on(p,w,v._dataApiKeydownHandler).on(`${d} ${c}`,v._clearMenus).on(d,_,(function(e){e.preventDefault(),e.stopPropagation(),v._jQueryInterface.call(t(this),"toggle")})).on(d,".dropdown form",(t=>{t.stopPropagation()})),t.fn[e]=v._jQueryInterface,t.fn[e].Constructor=v,t.fn[e].noConflict=function(){return t.fn[e]=o,v._jQueryInterface},v})($);export default Dropdown;
